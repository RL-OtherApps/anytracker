<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
    <record id="action_newlink" model="ir.actions.act_window">
        <field name="name">New link</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">anytracker.link</field>
        <field name="view_type">form</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
         <field name="flags">{'action_buttons': True}</field>
          <field name="context">{'default_ticket_one': active_id}</field>

    </record>

     <!-- link type -->
        <record id="view_link_type_form" model="ir.ui.view">
            <field name="name">anytracker.link.type.form</field>
            <field name="model">anytracker.link.type</field>
            <field name="type">form</field>
            <field name="priority" eval="8"/>
            <field name="arch" type="xml">
                <form string="Type">
                    <sheet>
                        <group>
                            <h1>
                                <field name="name" select="1" placeholder="Ticket type"/>
                            </h1>
                        </group>
                        <group>
                            <field name="description"/>
                            <field name="linktype_id"/>
                            <field name="state"/>

                        </group>
                    </sheet>
                </form>
            </field>
        </record>

    <!-- Add a tab in the ticket form -->
        <record id="view_ticket_with_link" model="ir.ui.view">
            <field name="name">Ticket</field>
            <field name="model">anytracker.ticket</field>
            <field name="inherit_id" ref="anytracker.invoicing_ticket_view_form" />
            <field name="arch" type="xml">

              <xpath expr="//notebook/page[@string='Sub-tickets']" position="after">
                <page string="Link-with">

                       <field name="all_links" nolabel="1" context="{'default_ticket_one':active_id}">
                             <tree string="Links" editable="bottom">

                                        <field name="number1"  />
                                        <field name="ticket_one" string="link ticket"/>
                                        <field name="stage1" />
                                        <field name="progress1" widget="progressbar"  />
                                        <field name="number2"  />
                                        <field name="ticket_two" string="link ticket"/>
                                        <field name="stage2" />
                                        <field name="progress2" widget="progressbar"  />
                                        <field name="linktype_id"/>



                            </tree>
                        </field>
                      <button string="Add link" icon="gtk-execute" type="action" name="%(action_newlink)d"/>

                </page>
              </xpath>
            </field>
        </record>



        <record model="ir.actions.act_window" id="act_open_types_link_view">
            <field name="name">Link types</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">anytracker.link.type</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>



        <menuitem id="menu_types_link"
                  parent="menu_configuration"
                  sequence="20"
                  action="act_open_types_link_view"/>



</data>
</openerp>

